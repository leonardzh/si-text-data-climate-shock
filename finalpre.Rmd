---
title: "Mini-Project Presentation"
author: "Portia Williams, Zheng Liu"
date: "7/26/2019"
output: html_document
---

```{r setup, include=FALSE}

library(knitr)
library(tools)
opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  cache = TRUE)
```

## Pursuit Project Idea


*Title: Understanding social responses to environmental shocks-A text mining approach*

Theme: Sudden and unexpected events

6 members (US, Africa and Asia)

## From Mini-project to Pursuit
![Framework](Proposal FINAL.bmp){ width=100% }

Pursuit: Scoping stage with 3 sub projects

Mini project related to project 1: Looking at the relationship between weather and sentiment

Aim: Explore approaches for overall contribution to main project

## Methods
- Scraping News Data
  ```
  req = urllib.request.Request(url)
  resp = urllib.request.urlopen(req)
  respData = resp.read()
  ```
- Text Mining
  ```
  paragraphs = re.findall(r'<p>(.*?)</p>',str(respData))
  ```
  
- Sentiment Analysis

- Regression

Linear Regression

(Sentiments ~ Temperature)

- Interactive mapping

Leaflet map


## Data

### News

Source: [The Gdelt Project](https://www.gdeltproject.org/)

Description: It provides events reported in articles published in the 65 live translated languages. The sample data we used was the latest 15 minute news data at 4pm, Tuesday.

Format: 61 columns total, but we are using id, latitude, longitude, city, origin_url only.

### Weather

Source: [CPC Global Daily Temperature](https://www.esrl.noaa.gov/psd/data/gridded/data.cpc.globaltemp.html)

Description:
- CPC .50x.50 Global Daily Temperature
- Spatial Coverage: 0.50 - degree latitude x 0.50 - degree longitude grid (720x360).
- Updated daily

Format: Max and Min tempertaure NetCDF4 files that can be directly downloaded from the link.

```{r load_data,context = 'data', echo = FALSE,results='hide',cache.extra = md5sum('T_data_CPC.R')}
source('T_data_CPC.R')
library(reshape2)
library(ggplot2)


```
--- 
```{r plot_T_map,echo = FALSE}
kable(allData[1:5,-5],caption = 'Data examples')
longData<-melt(lastdaymax)
longData<-longData[!is.na(longData$value),]

ggplot(longData, aes(x = Var1, y = -Var2)) + 
  geom_raster(aes(fill=value)) + 
  scale_fill_gradient(low="grey90", high="red") +
  labs(x="letters", y="LETTERS", title="Matrix") +
  theme_bw() + theme(axis.text.x=element_text(size=9, angle=0, vjust=0.3),
                     axis.text.y=element_text(size=9),
                     plot.title=element_text(size=11))
```











## Results and discussion


### Sentiment Analysis
```{r sentiment_analysis,eval=TRUE,echo=TRUE}

library(syuzhet)

allData$senti <- get_nrc_sentiment(allData$txt_content)
allData$sentiscore <- get_sentiment(allData$txt_content)
str(allData)

```
### Interactive Map
```{r load_map, echo = FALSE }
library(leaflet)

leaflet(data = allData[1:200,]) %>%
    addTiles() %>%
  addMarkers(~lon,~lat,
             popup=~as.character(sentiscore), 
             label = ~as.character(city)) %>%
    setView(lng = -77, lat = 39, 
        zoom = 7)



```

### Linear Regression

```{r regression,eval=TRUE }
model1 <- lm(
  formula = sentiscore ~ Tmin,
  data = allData)
summary(model1)

ggplot(allData,
  aes(x = Tmin, y = sentiscore)) +
  geom_point() +
  geom_line(aes(y = predict(model1))) +
  labs(title = 'Intercept and slope with lm')
```

```{r Linear Mix,eval=TRUE }
library(lme4)
model2 <- lmer(
  sentiscore ~ (Tmin|Tmax),
  data = allData)
summary(model2)

ggplot(allData,
  aes(x = Tmax, y = sentiscore)) +
  geom_point() +
  geom_line(aes(y = predict(model2))) +
  labs(title = 'Random intercept and slope with lmer')
```

### Future Work

1. Integrate text mining methods before the sentiment analysis

2. More precise sentiment measurement

3. Higher quality data for news and temperature


---
## Thank you!



\  
\  
\  
\  

Safe travel!







